// ======================================================================
// \title  AggregationMachineStateMachineAc.hpp
// \author Generated by fpp-to-cpp
// \brief  hpp file for AggregationMachine state machine
// ======================================================================

#ifndef Svc_AggregationMachineStateMachineAc_HPP
#define Svc_AggregationMachineStateMachineAc_HPP

#include "Fw/FPrimeBasicTypes.hpp"
#include "Fw/Types/ExternalString.hpp"
#include "Fw/Types/Serializable.hpp"
#include "Fw/Types/String.hpp"
#include "Fw/Types/SuccessEnumAc.hpp"
#include "Svc/Ports/CommsPorts/ComDataContextPairSerializableAc.hpp"

namespace Svc {

  //! Aggregation state machine
  class AggregationMachineStateMachineBase {

      // ----------------------------------------------------------------------
      // Friend classes
      // ----------------------------------------------------------------------

      //! Tester class for the state machine
      friend class AggregationMachineTester;

    public:

      // ----------------------------------------------------------------------
      // Types
      // ----------------------------------------------------------------------

      //! The state type
      enum class State : FwEnumStoreType {
        //! The uninitialized state
        __FPRIME_AC_UNINITIALIZED,
        //! Buffer aggregation in-progress
        FILL,
        //! Wait for com status from downstream
        WAIT_STATUS,
      };

      //! The signal type
      enum class Signal : FwEnumStoreType {
        //! The initial transition
        __FPRIME_AC_INITIAL_TRANSITION,
        //! Fill buffer signal
        fill,
        //! Status return
        status,
        //! Rate-group driven timeout signal
        timeout,
      };

    protected:

      // ----------------------------------------------------------------------
      // Constructors and Destructors
      // ----------------------------------------------------------------------

      //! Constructor
      AggregationMachineStateMachineBase();

      //! Destructor
      virtual ~AggregationMachineStateMachineBase();

    protected:

      // ----------------------------------------------------------------------
      // Initialization
      // ----------------------------------------------------------------------

      //! Initialize the state machine
      void initBase(
          const FwEnumStoreType id //!< The state machine ID
      );

    public:

      // ----------------------------------------------------------------------
      // Getter functions
      // ----------------------------------------------------------------------

      //! Get the state
      AggregationMachineStateMachineBase::State getState() const;

    public:

      // ----------------------------------------------------------------------
      // Send signal functions
      // ----------------------------------------------------------------------

      //! Rate-group driven timeout signal
      void sendSignal_timeout();

      //! Fill buffer signal
      void sendSignal_fill(
          const Svc::ComDataContextPair& value //!< The value
      );

      //! Status return
      void sendSignal_status(
          const Fw::Success& value //!< The value
      );

    protected:

      // ----------------------------------------------------------------------
      // Actions
      // ----------------------------------------------------------------------

      //! Clear the buffer fill state, last status
      virtual void action_doClear(
          Signal signal //!< The signal
      ) = 0;

      //! Fill the buffer with data
      virtual void action_doFill(
          Signal signal, //!< The signal
          const Svc::ComDataContextPair& value //!< The value
      ) = 0;

      //! Send the buffer data
      virtual void action_doSend(
          Signal signal //!< The signal
      ) = 0;

      //! Hold a buffer
      virtual void action_doHold(
          Signal signal, //!< The signal
          const Svc::ComDataContextPair& value //!< The value
      ) = 0;

      //! Assert no status when in fill state
      virtual void action_assertNoStatus(
          Signal signal //!< The signal
      ) = 0;

    protected:

      // ----------------------------------------------------------------------
      // Guards
      // ----------------------------------------------------------------------

      //! Check if the aggregation buffer is full, i.e. cannot accept the incoming buffer
      virtual bool guard_isFull(
          Signal signal, //!< The signal
          const Svc::ComDataContextPair& value //!< The value
      ) const = 0;

      //! Check if the aggregation will fill, i.e. the incoming buffer will exactly fit
      virtual bool guard_willFill(
          Signal signal, //!< The signal
          const Svc::ComDataContextPair& value //!< The value
      ) const = 0;

      //! Check if not empty
      virtual bool guard_isNotEmpty(
          Signal signal //!< The signal
      ) const = 0;

      //! Check if last status is good
      virtual bool guard_isGood(
          Signal signal, //!< The signal
          const Fw::Success& value //!< The value
      ) const = 0;

    private:

      // ----------------------------------------------------------------------
      // State and choice entry
      // ----------------------------------------------------------------------

      //! Enter state FILL
      void enter_FILL(
          Signal signal //!< The signal
      );

      //! Enter state WAIT_STATUS
      void enter_WAIT_STATUS(
          Signal signal //!< The signal
      );

      //! Enter choice IS_GOOD_STATUS
      void enter_IS_GOOD_STATUS(
          Signal signal, //!< The signal
          const Fw::Success& value //!< The value
      );

      //! Enter choice WILL_FILL_THEN_SEND
      void enter_WILL_FILL_THEN_SEND(
          Signal signal, //!< The signal
          const Svc::ComDataContextPair& value //!< The value
      );

      //! Enter choice IS_FULL_THEN_SEND
      void enter_IS_FULL_THEN_SEND(
          Signal signal, //!< The signal
          const Svc::ComDataContextPair& value //!< The value
      );

    protected:

      // ----------------------------------------------------------------------
      // Member variables
      // ----------------------------------------------------------------------

      //! The state machine ID
      FwEnumStoreType m_id = 0;

      //! The state
      State m_state = State::__FPRIME_AC_UNINITIALIZED;

  };

}

#endif
