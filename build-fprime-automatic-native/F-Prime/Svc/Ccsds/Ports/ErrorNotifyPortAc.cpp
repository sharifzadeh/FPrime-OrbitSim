// ======================================================================
// \title  ErrorNotifyPortAc.cpp
// \author Generated by fpp-to-cpp
// \brief  cpp file for ErrorNotify port
// ======================================================================

#include "Fw/Types/Assert.hpp"
#include "Fw/Types/ExternalString.hpp"
#include "Svc/Ccsds/Ports/ErrorNotifyPortAc.hpp"

namespace Svc {

  namespace Ccsds {

    namespace {

      // ----------------------------------------------------------------------
      // Port buffer class
      // ----------------------------------------------------------------------

      class ErrorNotifyPortBuffer : public Fw::LinearBufferBase {

        public:

          Fw::Serializable::SizeType getCapacity() const {
            return InputErrorNotifyPort::SERIALIZED_SIZE;
          }

          U8* getBuffAddr() {
            return m_buff;
          }

          const U8* getBuffAddr() const {
            return m_buff;
          }

        private:

          U8 m_buff[InputErrorNotifyPort::SERIALIZED_SIZE];

      };

    }

    // ----------------------------------------------------------------------
    // Input Port Member functions
    // ----------------------------------------------------------------------

    InputErrorNotifyPort ::
      InputErrorNotifyPort() :
        Fw::InputPortBase(),
        m_func(nullptr)
    {

    }

    void InputErrorNotifyPort ::
      init()
    {
      Fw::InputPortBase::init();
    }

    void InputErrorNotifyPort ::
      addCallComp(
          Fw::PassiveComponentBase* callComp,
          CompFuncPtr funcPtr
      )
    {
      FW_ASSERT(callComp != nullptr);
      FW_ASSERT(funcPtr != nullptr);

      this->m_comp = callComp;
      this->m_func = funcPtr;
      this->m_connObj = callComp;
    }

    void InputErrorNotifyPort ::
      invoke(const Svc::Ccsds::FrameError& errorCode)
    {
#if FW_PORT_TRACING == 1
      this->trace();
#endif

      FW_ASSERT(this->m_comp != nullptr);
      FW_ASSERT(this->m_func != nullptr);

      return this->m_func(this->m_comp, this->m_portNum, errorCode);
    }

#if FW_PORT_SERIALIZATION == 1

    Fw::SerializeStatus InputErrorNotifyPort ::
      invokeSerial(Fw::LinearBufferBase& _buffer)
    {
      Fw::SerializeStatus _status;

#if FW_PORT_TRACING == 1
      this->trace();
#endif

      FW_ASSERT(this->m_comp != nullptr);
      FW_ASSERT(this->m_func != nullptr);

      Svc::Ccsds::FrameError errorCode;
      _status = _buffer.deserializeTo(errorCode);
      if (_status != Fw::FW_SERIALIZE_OK) {
        return _status;
      }

      this->m_func(this->m_comp, this->m_portNum, errorCode);

      return Fw::FW_SERIALIZE_OK;
    }

#endif

    // ----------------------------------------------------------------------
    // Output Port Member functions
    // ----------------------------------------------------------------------

    OutputErrorNotifyPort ::
      OutputErrorNotifyPort() :
        Fw::OutputPortBase(),
        m_port(nullptr)
    {

    }

    void OutputErrorNotifyPort ::
      init()
    {
      Fw::OutputPortBase::init();
    }

    void OutputErrorNotifyPort ::
      addCallPort(InputErrorNotifyPort* callPort)
    {
      FW_ASSERT(callPort != nullptr);

      this->m_port = callPort;
      this->m_connObj = callPort;

#if FW_PORT_SERIALIZATION == 1
      this->m_serPort = nullptr;
#endif
    }

    void OutputErrorNotifyPort ::
      invoke(const Svc::Ccsds::FrameError& errorCode) const
    {
#if FW_PORT_TRACING == 1
      this->trace();
#endif

#if FW_PORT_SERIALIZATION
      FW_ASSERT((this->m_port != nullptr) || (this->m_serPort != nullptr));

      if (this->m_port != nullptr) {
        this->m_port->invoke(errorCode);
      }
      else {
        Fw::SerializeStatus _status;
        ErrorNotifyPortBuffer _buffer;

        _status = _buffer.serializeFrom(errorCode);
        FW_ASSERT(_status == Fw::FW_SERIALIZE_OK, static_cast<FwAssertArgType>(_status));

        _status = this->m_serPort->invokeSerial(_buffer);
        FW_ASSERT(_status == Fw::FW_SERIALIZE_OK, static_cast<FwAssertArgType>(_status));
      }
#else
      FW_ASSERT(this->m_port != nullptr);
      this->m_port->invoke(errorCode);
#endif
    }

  }

}
